<div class="main-carousel">
  <% @property.photos.each do |photo| %>
    <div class="carousel-cell">
      <%= cl_image_tag(photo.key, :width => 800, :height => 600, :crop => :fill, class:"d-block")%>
    </div>
  <% end %>
</div>
<div class="container-show">
  <div class="card-show">
    <h2><%= @property.property_type %> - <%= @property.price %> - <%= @property.address %></h2>
    <p class="fas fa-map-marker">  <%= @property.address %></p>
    <p class="far fa-square"> <%= @property.land_surface %> m2</p>
    <p class="fas fa-square"> <%= @property.living_space %> m2</p>
    <p><%= @property.bedrooms %> Bedrooms</p>
    <p><%= @property.bathroom %> Bathrooms</p>
    <p><%= @property.parking_space %> Parking Spaces</p>
    <%if @property.sea_view == true %>
      <p>Sea view</p>
    <% end %>
    <%if @property.pool == true %>
      <p>Pool</p>
    <% end %>
    <p class="fas fa-coins">  <%=@property.price %> MUR</p>
  </div>
  <div class="card-show" >
    <p><%= @property.description %></p>
  </div>
</div>
<div class="container-show">
  <% if current_user == @property.owner %>
    <div class="card-edit">
      <% if policy(@property).destroy? %>
        <%= link_to 'Delete Property', @property, :class => "btn btn-danger btn-lg",  method: :delete, data: { confirm: 'Are you sure?' } %>
      <% end %>
      <% if policy(@property).edit? %>
        <%= link_to 'Edit property', edit_property_path, class: "btn btn-info btn-lg" %>
      <% end %>
      <% if policy(@slot).new? %>
        <%= link_to 'New Slot', new_property_slot_path(@property), class:"btn btn-success btn-lg"%>
      <% end %>
    </div>
  <% end %>
</div>
<div class="container-show">
  <div class="card-slot">
    <table>
      <tr>
        <th></th>
        <th></th>
      </tr>
      <% @slots.each do |slot| %>
        <tr>
          <td>
            <h3><%= slot.date.to_formatted_s(:long)%></h3>
          </td>
          <% if policy(slot).destroy? %>
            <td><%= link_to 'Delete Slot', slot_path(slot), class:"btn btn-danger btn-lg m-2", method: :delete %></td>
          <% end %>
          <%# if policy(@booking).create? %>
          <% if current_user != @property.owner %>
            <td><%= link_to "BOOK VISIT OF THIS PROPERTY", property_bookings_path(@property, slot_id:slot.id), class:"btn btn-primary btn-lg m-2", method: :post %></td>
          <% end %>
        </tr>
      <% end %>
    </table>
  </div>
</div>
<div class="container-show">
  <div id="map" class="card-map"
     data-markers="<%= @markers.to_json %>"
     data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>
</div>
<div class="container-show">
  <div class="card-message">
    <% if current_user == @property.owner %>
      <%= link_to "Open messages for this property", dashboard_path, class:"btn btn-primary btn-lg" %>
    <% else %>
      <% if @message %>
        <%= link_to 'See messages with this owner', property_chat_room_path(@property, @message.chat_room),class:"btn btn-primary btn-lg" %>
      <% else %>
        <%= link_to 'Send a message to the owner', property_chat_rooms_path(@property),class:"btn btn-primary btn-lg", method: :post %>
      <% end %>
    <% end %>
  </div>
</div>
